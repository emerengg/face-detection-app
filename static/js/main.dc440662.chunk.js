(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{20:function(e,t,a){e.exports=a(30)},29:function(e,t,a){},30:function(e,t,a){"use strict";a.r(t);var n=a(0),l=a.n(n),r=a(11),i=a.n(r),s=a(2),c=a(3),o=a(6),d=a(4),u=a(7),m=a(1),p=a(5),h=a(18),f=a(19),g=a(9),v={data:{},uploadError:null},E=Object(p.combineReducers)({faces:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:v,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"GET_FACES":return{data:t.payload};case"RESET_STORE":return Object(g.a)({},e,{data:{}});case"UPLOAD_ERROR":return Object(g.a)({},e,{uploadError:"Couldn't upload the image! Try again!"});case"CLEAR_UPLOAD_ERROR":return Object(g.a)({},e,{uploadError:null});default:return e}}}),b=[f.a],y=Object(p.createStore)(E,{},Object(h.composeWithDevTools)(p.applyMiddleware.apply(void 0,b))),w=function(){return function(e){e({type:"RESET_STORE"})}},O=Object(m.b)(null,{resetStore:w})(function(e){var t=e.display,a=e.faces,n=e.handleDisplay,r=e.handleBlur,i=e.handleClear,s=e.resetStore,c=t?{opacity:1,cursor:"pointer"}:{opacity:.5,cursor:"default"};return l.a.createElement("div",{className:"menu","data-testid":"menu"},l.a.createElement("div",null,l.a.createElement("button",{className:"btn","data-testid":"sa",onClick:function(){r()},style:c},l.a.createElement("i",{className:"material-icons left"},"blur_on"),"Blur"),l.a.createElement("button",{className:"btn",onClick:function(){i()}},l.a.createElement("i",{className:"material-icons left"},"undo"),l.a.createElement("span",null,"Undo"))),l.a.createElement("div",null,l.a.createElement("p",{className:"display-faces"},"Display ",1===a?l.a.createElement("span",null,"face"):l.a.createElement("span",null,"faces")),l.a.createElement("label",{htmlFor:"displayFaces",className:"switch"},l.a.createElement("input",{type:"checkbox",id:"displayFaces","data-testid":"displayFaces",checked:t,onChange:function(){n()}}),l.a.createElement("span",{className:"slider round"}))),l.a.createElement("div",null,l.a.createElement("button",{className:"btn",onClick:function(){s()}},l.a.createElement("i",{className:"material-icons left"},"file_upload"),"Upload")))}),j=function(e){var t=e.object,a=e.handleUpdateState,n=t.cords,r=t.isSelected,i={top:String(n.y)+"px",left:String(n.x)+"px",position:"absolute",width:String(n.w)+"px",height:String(n.h)+"px",pointer:"cursor",border:""};return i.border=r?"2px solid blue":"2px solid red",l.a.createElement("div",{className:"overlay",style:i,onClick:function(){return a(n)}})},S=function(e){var t=e.display,a=e.handleTooltip,n={position:"absolute",top:10,left:10};return n.visibility=t?"visible":"hidden",l.a.createElement("div",{className:"tooltip",style:n},l.a.createElement("p",{className:"tip"},"Click on one of the ",l.a.createElement("span",null,"red squares")," to select it."),l.a.createElement("i",{className:"material-icons",onClick:a},"close"))},C=function(e){function t(e){var a;Object(s.a)(this,t),(a=Object(o.a)(this,Object(d.a)(t).call(this,e))).componentDidMount=function(){a.updateCanvas(),window.onresize=function(){a.state.display&&a.setState({display:!1}),a.updateCanvas()}},a.componentWillUnmount=function(){window.onresize=function(){try{a.updateCanvas()}catch(e){}}},a.updateCanvas=function(){var e=a.state.facesCords,t=a.refs,n=t.canvas,l=t.cvs,r=n.getContext("2d");a.setState({canvas:n});var i=l.clientWidth,s=l.clientHeight,c=new Image;c.onload=function(){var t,l=0;n.width=i,n.height=s;var o=c.width/c.height,d=n.width,u=d/o;u>n.height&&(u=n.height,d=u*o,l=(n.width-d)/2),t=(n.height-u)/2;var m=e.map(function(e){var a=Math.round(e.x/c.width*d+l),n=Math.round(e.y/c.height*u+t);return{cords:{x:a,y:n,w:Math.round(e.w/c.width*d-a+l),h:Math.round(e.h/c.height*u-n+t)},isSelected:!1}});r.drawImage(c,l,t,d,u),a.setState({objects:m,image:c,canvasPosition:{x:l,y:t,w:d,h:u}})},c.src=a.props.image},a.handleBlur=function(){var e=a.refs,t=e.canvas,n=e.fcanvas,l=t.getContext("2d"),r=n.getContext("2d"),i=!0,s=!1,c=void 0;try{for(var o,d=a.state.objects[Symbol.iterator]();!(i=(o=d.next()).done);i=!0){var u=o.value;if(u.isSelected){var m=l.getImageData(u.cords.x,u.cords.y,u.cords.w,u.cords.h);n.width=m.width,n.height=m.height,r.putImageData(m,0,0);var p=void 0;p=m.height>=300?5:m.height>=240?5:m.height>=180?4:m.height>=120?3:2,r.globalAlpha=.5;for(var h=-p;h<=p;h+=2)for(var f=-p;f<=p;f+=2)r.drawImage(n,-f,-h);r.globalAlpha=1;var g=r.getImageData(0,0,m.width,m.height);l.putImageData(g,u.cords.x,u.cords.y)}}}catch(v){s=!0,c=v}finally{try{i||null==d.return||d.return()}finally{if(s)throw c}}},a.upadateState=function(e){var t=a.state.objects.map(function(t){return t.cords.x===e.x?Object(g.a)({},t,{isSelected:!t.isSelected}):t});a.setState({objects:t})},a.handleClear=function(){var e=a.state,t=e.image,n=e.canvasPosition;a.refs.canvas.getContext("2d").drawImage(t,n.x,n.y,n.w,n.h)},a.handleDisplay=function(){a.setState({display:!a.state.display})},a.handleTooltip=function(){a.setState({isTooltip:!a.state.isTooltip})};var n=a.props,l=n.cords,r=n.image;return a.state={facesCords:l,image:r,objects:[],display:!1,canvas:null,canvasPosition:{x:null,y:null,w:null,h:null},isTooltip:!0},a}return Object(u.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this,t=this.props.resetStore,a=this.state,n=a.canvas,r=a.display,i=a.facesCords,s=a.objects,c=a.isTooltip,o=n?{height:"".concat(n.height,"px")}:null;return l.a.createElement("div",{className:"canvas-menu"},l.a.createElement("div",{className:"canvas-wrapper",ref:"cvs",style:o},l.a.createElement("canvas",{ref:"canvas"}),i.length>0&&r?s.map(function(t,a){return l.a.createElement(j,{key:a,object:t,handleUpdateState:e.upadateState})}):null,c&&l.a.createElement(S,{display:r,handleTooltip:this.handleTooltip})),l.a.createElement("canvas",{ref:"fcanvas",style:{width:"40px",height:"40px",display:"none"}}),i.length>0?l.a.createElement(O,{display:r,handleDisplay:this.handleDisplay,handleClear:this.handleClear,handleBlur:this.handleBlur,faces:i.length}):l.a.createElement("div",{className:"not-found"},l.a.createElement("p",null,"No faces found!"),l.a.createElement("button",{onClick:function(){return t()}},"Upload new image")))}}]),t}(n.Component),N=Object(m.b)(function(e){return{cords:e.faces.data.cords,image:e.faces.data.image}},{resetStore:w})(C),x=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,l=new Array(n),r=0;r<n;r++)l[r]=arguments[r];return(a=Object(o.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(l)))).state={image:null,name:null,status:!1,error:null},a.handleSelectedFile=function(e){try{var t=e.target.files[0],n=e.target.files[0].name,l=n.lastIndexOf(".")+1,r=n.substr(l,n.length).toLowerCase();if("jpg"===r||"jpeg"===r||"png"===r){var i=new FileReader;i.onload=function(){var e=new Image;e.onload=function(){},e.src=i.result},i.readAsDataURL(t);var s=n.length<=10?n:"".concat(n.substring(0,9),"...");a.setState({image:t,name:s,error:null})}else a.setState({image:null,name:null,status:!1,error:"Only jpg/jpeg and png files are allowed!"})}catch(c){}},a.handleSubmit=function(e){e.preventDefault();var t={image:a.state.image};a.props.getFaces(t),a.setState({status:!a.state.status})},a}return Object(u.a)(t,e),Object(c.a)(t,[{key:"componentDidUpdate",value:function(e,t){var a=this,n=this.props.uploadError;n!==e.uploadError&&n&&this.setState({image:null,name:null,status:!1,error:n},function(){null!==a.props.uploadError&&a.props.clearUploadError()})}},{key:"render",value:function(){var e=this.state,t=e.name,a=e.error,n=t||a?{visibility:"visible"}:{visibility:"hidden"};return l.a.createElement(l.a.Fragment,null,this.state.status?l.a.createElement("div",{className:"loading","data-testid":"loading"},l.a.createElement("div",{className:"loader"})):l.a.createElement("div",{className:"upload-form"},l.a.createElement("form",{onSubmit:this.handleSubmit,"data-testid":"image-upload-form"},l.a.createElement("input",{type:"file",className:"inputfile",id:"imageUpload",onChange:this.handleSelectedFile,"data-testid":"imageUpload"}),l.a.createElement("label",{className:"upload",htmlFor:"imageUpload"},l.a.createElement("i",{className:"ico fas fa-file-upload fa-10x"}),t?l.a.createElement("span",{"data-testid":"imageName"},t):l.a.createElement("span",null,"Choose a file...")),a?l.a.createElement("div",{className:"upload-error",style:n},a):l.a.createElement("button",{type:"submit",className:"btn",style:n,id:"upload-btn",name:"action"},"Upload"))))}}]),t}(n.Component),R=Object(m.b)(function(e){return{uploadError:e.faces.uploadError}},{getFaces:function(e){return function(t,a){var n=window.URL.createObjectURL(e.image),l=new FormData;l.append("img",e.image,e.image.name),fetch("http://127.0.0.1:8000/api/fd/",{method:"POST",body:l}).then(function(e){if(e.ok)return e.json();throw e}).then(function(e){var a=JSON.parse(e.cords),l={minNeighbors:e.min_neighbors,scaleFactor:e.scale_factor},r=e.unique_id,i=a.map(function(e){return{x:e.x,y:e.y,w:e.xw,h:e.yh}});t({type:"GET_FACES",payload:{id:r,settings:l,cords:i,image:n}})}).catch(function(e){t({type:"UPLOAD_ERROR"})})}},clearUploadError:function(){return function(e,t){e({type:"CLEAR_UPLOAD_ERROR"})}}})(x),D=(a(29),function(e){function t(){return Object(s.a)(this,t),Object(o.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(u.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this.props.image;return l.a.createElement("div",{className:"app"},l.a.createElement("div",{className:"main"},e?l.a.createElement(N,null):l.a.createElement("div",{className:"start-screen"},l.a.createElement("div",{className:"title"},l.a.createElement("h1",null,"Face Detection App")),l.a.createElement(R,null),l.a.createElement("div",{className:"reference"},l.a.createElement("div",{className:"ref-item"},l.a.createElement("a",{href:"https://github.com/emerengg/face-detection-app"},l.a.createElement("i",{className:"icons fab fa-github fa-lg"})),l.a.createElement("small",null,"GitHub"))),l.a.createElement("div",{className:"wave"},l.a.createElement("svg",{width:"1920",height:"477",viewBox:"0 0 1920 477",fill:"none",xmlns:"http://www.w3.org/2000/svg"},l.a.createElement("path",{d:"M1621 82.0001C1749.02 0.539482 1920 0.65332 1920 0.65332V477H0V74.5C0 74.5 256.5 160.092 415 160.092C573.5 160.092 611 77.6485 802 118C993 158.351 1131 199 1293 188.633C1455 178.266 1505 155.813 1621 82.0001Z",fill:"black"}))))))}}]),t}(n.Component)),U=Object(m.b)(function(e){return{image:e.faces.data.image}})(D),k=function(e){function t(){return Object(s.a)(this,t),Object(o.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(u.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return l.a.createElement(m.a,{store:y},l.a.createElement(U,null))}}]),t}(n.Component);i.a.render(l.a.createElement(k,null),document.getElementById("root"))}},[[20,1,2]]]);
//# sourceMappingURL=main.dc440662.chunk.js.map